# Commiat ü§ñ‚úçÔ∏è

Tired of writing git commit messages? Let AI do it for you! ‚ú®

`commiat` is a simple CLI tool that:
1.  Optionally stages all changes (`git add .`) if you use the `-a` flag.
2.  Analyzes your staged git changes (`git diff --staged`).
3.  Generates a commit message using the OpenRouter API (defaults to Google Gemini Flash 1.5 ‚ö°).
4.  **Supports custom commit message formats** defined in a local `.commiat` file.
5.  Prompts you to confirm ‚úÖ, adjust üìù, or cancel ‚ùå the commit.

## üöÄ Installation

### Option 1: Install from npm (Recommended)
```bash
npm install -g commiat
```

### Option 2: Manual Installation
1.  **Clone the repository:**
    ```bash
    git clone https://github.com/javimosch/commiat.git
    cd commiat
    ```
2.  **Install dependencies:**
    ```bash
    npm install
    ```
3.  **Link the CLI:**
    This makes the `commiat` command available globally.
    ```bash
    npm link
    ```

## ‚öôÔ∏è Configuration

`commiat` uses two types of configuration:

### 1. Global Configuration (`~/.commiat/config`)

This file stores settings that apply across all your projects, primarily your API key and default model. It uses the standard `.env` format (KEY=VALUE).

*   **Location:** `~/.commiat/config` (created automatically if needed)
*   **Managed via:** `commiat config` command
*   **Key Settings:**
    *   `COMMIAT_OPENROUTER_API_KEY`: Your OpenRouter API key (required). If not found here or in environment variables, you'll be prompted.
    *   `COMMIAT_OPENROUTER_MODEL`: The default OpenRouter model ID (e.g., `google/gemini-flash-1.5`, `anthropic/claude-3-haiku`). Defaults to `google/gemini-flash-1.5`.

### 2. Project-Specific Format Configuration (`.commiat`)

This optional file, placed in your project's root directory, allows you to define a custom commit message format for that specific project.

*   **Location:** `.commiat` in your project root.
*   **Format:** JSON
*   **Structure:**
    ```json
    {
      "format": "{type}({scope}): {msg} - #{gitBranch}",
      "variables": {
        "scope": "Description of what 'scope' means in this project (e.g., component, module, feature name)"
      }
    }
    ```
*   **`format` (string, required):** The template for your commit messages.
    *   Use `{variableName}` for placeholders.
    *   `{msg}` is special: The main commit message generated by the AI will replace this.
    *   **System Variables:**
        *   `{gitBranch}`: Automatically replaced with the current Git branch name.
        *   `{type}`: The conventional commit type (e.g., `feat`, `fix`, `chore`) determined by the AI based on the diff. The AI is instructed to generate this.
    *   **Custom Variables:** Any other `{variableName}` (like `{scope}` above) is a custom variable.
*   **`variables` (object, required):** Contains descriptions for your *custom* variables.
    *   The keys are the custom variable names (e.g., `"scope"`).
    *   The values are strings describing what information should go into that variable. These descriptions are sent to the AI to help it fill the template correctly.
    *   If you add a new custom variable to your `format` string, `commiat` will prompt you to provide its description the next time you run it, and it will save the description back to your `.commiat` file.

### Configuration Precedence

Settings are looked for in this order:

1.  **Environment Variables / Local `.env` File:** `COMMIAT_OPENROUTER_API_KEY` and `COMMIAT_OPENROUTER_MODEL` set in your shell or a project-local `.env` file override everything else.
2.  **Project `.commiat` File:** If present, the `format` and `variables` defined here are used for commit message generation.
3.  **Global `~/.commiat/config` File:** Used for `COMMIAT_OPENROUTER_API_KEY` and `COMMIAT_OPENROUTER_MODEL` if not set by environment variables.
4.  **Prompts / Defaults:**
    *   If `COMMIAT_OPENROUTER_API_KEY` is not found, you'll be prompted, and it will be saved globally.
    *   If `COMMIAT_OPENROUTER_MODEL` is not found, `google/gemini-flash-1.5` is used.
    *   If `.commiat` is not found, a standard conventional commit format (`{type}: {msg}`) is used. If `.commiat` is missing custom variable descriptions, you'll be prompted.

## ‚ñ∂Ô∏è Usage

1.  **(Optional) Create a `.commiat` file** in your project root if you want a custom format (see example above).
2.  **Stage your changes:**
    ```bash
    git add <your-files...>
    # OR stage all changes:
    git add .
    ```
3.  **Run commiat:**
    ```bash
    commiat
    # OR use the -a flag to stage all changes AND run:
    commiat -a
    ```
4.  **Follow the prompts:**
    *   If it's the first time using a custom variable in `.commiat`, you'll be asked for its description.
    *   Confirm, adjust, or cancel the suggested commit message.

**Example Workflow with Custom Format:**

*   Create `.commiat`:
    ```json
    {
      "format": "feat({component}): {msg} [#{gitBranch}]",
      "variables": {
        "component": "The UI component or backend module affected"
      }
    }
    ```
*   Make changes, stage them (`git add .`).
*   Run `commiat`.
*   AI generates a message like: `feat(Button): add loading state [#feature/new-button]`
*   Confirm or adjust.

## Other Commands

*   **Edit Global Configuration:**
    Opens `~/.commiat/config` in your editor.
    ```bash
    commiat config
    ```
*   **Test API Configuration:**
    Checks connection using settings from global config / env vars.
    ```bash
    commiat config --test
    ```

Happy committing! üéâ
